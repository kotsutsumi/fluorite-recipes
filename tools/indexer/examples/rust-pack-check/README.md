# Rust Pack Check

This example binary verifies that the SQLite packs generated by the Fluorite indexer can be opened from Rust, queried with FTS5, and (optionally) ranked with dense embeddings.

## Usage

1. Generate or copy a pack (defaults to `packs/fluorite-pack.sqlite3` in the repository root).
2. From this directory run one of the subcommands:

```bash
cargo run -- info
cargo run -- search --query "tika server"
```

Use `--pack` to point at a different SQLite file and `--root` to override the repository root that is used when resolving relative pack paths. The CLI mirrors the indexer's environment variables (`FLUORITE_PACK_PATH`, `FLUORITE_PACK_DIR`, etc.).

## Embedding support

Vector scoring is behind an optional Cargo feature to keep the default build free of heavy dependencies:

```bash
cargo run --features embeddings -- search --query "hybrid retrieval"
```

When the `embeddings` feature is enabled the binary downloads and loads the BAAI `bge-small-en-v1.5` model via [`fastembed`](https://crates.io/crates/fastembed). That path currently relies on the ONNX Runtime download helper, which in turn requires OpenSSL headers/libraries (e.g. `libssl-dev` on Debian/Ubuntu). If the feature is compiled out, the CLI falls back to BM25/FTS only and prints a warning the first time you attempt a semantic search.

## Typical workflow

1. Run the indexer: `pnpm --filter @fluorite/indexer index path/to/doc.md`.
2. Inspect the pack: `cargo run -- info`.
3. Run a query: `cargo run -- search --query "your question"`.
4. (Optional) Re-run the search with embeddings enabled for semantic ranking.

The program prints the resolved pack location, document counts, and top-ranked chunks (with doc ID, chunk ID, and a truncated preview) so you can sanity-check the data that the Rust agent will later consume.
