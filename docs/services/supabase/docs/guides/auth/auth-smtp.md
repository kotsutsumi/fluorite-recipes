# カスタムSMTPでメールを送信する

## 概要

以下の設定でSupabase Authを使用している場合:
- メールとパスワードによるアカウント
- パスワードレスアカウント（OTP、マジックリンク、招待）
- メールベースのユーザー招待
- メール確認を伴うソーシャルログイン

メッセージ配信を処理するためにカスタムSMTPサーバーを設定する必要があります。

## デフォルトSMTPサービスの制限

Supabaseは重要な制限を持つシンプルなSMTPサーバーを提供しています:

### 主な制限事項
- **事前承認されたアドレスのみ**: メッセージはプロジェクトチームメンバーにのみ送信できます
- **レート制限**: 現在1時間あたり2メッセージに設定されています
- **SLA保証なし**

デフォルトサービスは以下の用途を想定しています:
- Supabase Authの探索
- メールテンプレートのテスト
- デモ/非クリティカルなアプリケーションの構築

## カスタムSMTPサーバーの設定

### サポートされているメールサービス
- Resend
- AWS SES
- Postmark
- Twilio SendGrid
- ZeptoMail
- Brevo

### 設定手順
1. メール送信サービスを選択
2. アカウントを作成
3. SMTP設定を取得:
   - SMTPサーバーホスト
   - ポート
   - ユーザー認証情報
   - デフォルトの「From」アドレス（例: `no-reply@example.com`）

### 設定方法
- 認証設定ページ経由
- Management API使用（curlの例が提供されています）

## 悪用への対処と評判の維持

### 一般的な悪用シナリオ
ボットや攻撃者は以下を行う可能性があります:
- メール送信の評判に悪影響を与える
- サービス拒否攻撃を試みる
- セキュリティ態勢を低下させようとする

### 緩和戦略
- CAPTCHA保護を設定する
- ソーシャルログインまたはSSOを優先する
- パスワードレス認証を使用する
- メール確認の無効化を避ける

### ベストプラクティス
- DKIM、DMARC、SPF設定を行う
- カスタムドメインを使用する
- Authとマーケティングのメールを分離する
- バックアップSMTPサービスを用意する
- 一貫性のある焦点を絞ったメールコンテンツを使用する
- ユーザー急増イベントに備える

### 高度な制御
以下のようなより複雑なシナリオには、Send Email Auth Hookの使用を検討してください:
- カスタムテンプレート
- キューイング
