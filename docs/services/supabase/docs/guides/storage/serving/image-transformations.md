# Storage画像変換

## Storageで画像を変換する

Supabase Storageは、オンザフライで画像を最適化およびリサイズする機能を提供します。バケットに保存されている任意の画像を変換し、高速配信のために最適化できます。

> 画像リサイズは現在Proプラン以上で有効です。

## 変換された画像のパブリックURLを取得する

`getPublicUrl`や`createSignedUrl`などのクライアントライブラリメソッドは`transform`オプションをサポートしています。これにより、変換された画像を配信するURLが返されます。

URL例:
```
https://project_id.supabase.co/storage/v1/render/image/public/bucket/image.jpg?width=500&height=600
```

## 変換オプション付きでURLに署名する

プライベートバケット内の変換された画像を一定期間共有するには、署名付きURLを作成する際にtransformオプションを提供します。

> 変換オプションはURLに付加されたトークンに埋め込まれます — 一度署名されると変更できません。

## 画像のダウンロード

変換された画像をダウンロードするには、`download`関数に`transform`オプションを渡します。

## 自動画像最適化（WebP）

画像変換APIを使用する場合、Storageは自動的にクライアントがサポートする最適なフォーマットを見つけます:

- 画像をWebPとして自動的に最適化
- ユーザーへのエグレスを削減
- アプリケーションの読み込みを高速化

> 現在はWebPのみをサポートしています。AVIFサポートは近い将来追加される予定です。

### 自動最適化の無効化

元の画像フォーマットを返すには、変換された画像をリクエストする際に`format=origin`パラメータを渡します。

## 変換オプション

サポートされている変換オプション:

### 最適化
- 画像品質を20〜100で設定（デフォルト80）

### リサイズ
- `width`と`height`パラメータを使用
- 1つのパラメータのみ指定された場合、アスペクト比を維持

### リサイズモード
- `cover`: アスペクト比を維持しながらリサイズし、はみ出た部分を切り取る（デフォルト）
- `contain`: サイズに収まるようにアスペクト比を維持してリサイズ
- `fill`: アスペクト比を維持せずにリサイズ

### 制限
- 幅/高さ: 1〜2500の整数
- 画像サイズ: 最大25MB
- 解像度: 最大50MP

## 価格

オリジナル画像1,000枚あたり5ドル、サブスクリプションプランのクォータを超える使用量に対してのみ課金されます。

## セルフホスティング

セルフホスティングの詳細については、ドキュメントを参照してください。
