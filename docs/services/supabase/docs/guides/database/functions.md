# データベース関数

## 概要

PostgresはデータベースSQL関数をサポートしており、データベース内で作成および使用できます。これらの関数は:
- ダッシュボードまたはSQLで作成
- データベース内で直接実行
- クライアントライブラリを介して呼び出し

## 主な概念

### シンプルな関数の例

```sql
create or replace function hello_world()
returns text
language sql
as $$
  select 'hello world';
$$;
```

### 関数のコンポーネント

1. 関数宣言
2. 戻り値の型
3. 言語指定
4. `$$`で囲まれた関数本体

### 関数の種類

- シンプルなテキスト戻り値関数
- データセットを返す関数
- パラメータを持つ関数

### 実行方法

- 直接SQLクエリ
- クライアントライブラリのRPC呼び出し（JavaScript、Dart、Swift、Kotlin、Python）

## ベストプラクティス

### 関数作成の推奨事項

- 一意の関数名を使用
- 適切な言語を選択（`sql`、`plpgsql`）
- セキュリティ設定を考慮（`invoker`対`definer`）

### セキュリティに関する考慮事項

- デフォルト: 関数は任意のロールで実行可能
- 実行を制限できます:
  - ケースバイケースで権限を取り消す
  - デフォルトの実行制限を設定

### パフォーマンスガイダンス

- データ集約的な操作にはデータベース関数を使用
- 低レイテンシ要件にはエッジ関数を使用

## 高度な機能

- パラメータの受け渡し
- 複雑なデータセットの返却
- エラーハンドリング
- ロギングとデバッグ

このドキュメントは、Supabase経由でPostgresのデータベース関数を作成、使用、管理するための包括的なガイダンスを提供します。
