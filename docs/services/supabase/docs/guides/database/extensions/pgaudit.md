# PGAudit: Postgres監査

## 概要

[PGAudit](https://www.pgaudit.org)は、Postgresの組み込みロギング機能を拡張し、データベース活動の選択的な追跡を可能にします。以下の用途に役立ちます：

- **コンプライアンス**: 規制の監査要件を満たす
- **セキュリティ**: 疑わしいデータベース活動を検出
- **トラブルシューティング**: データベースの問題を特定して修正

## 拡張機能の有効化

### ダッシュボードを使用する方法
1. ダッシュボードのDatabaseページに移動
2. サイドバーの"Extensions"をクリック
3. `pgaudit`を検索して拡張機能を有効化

## 設定レベル

PGAuditは、異なる精度レベルで設定できます：

- **セッションロギング**: 接続内の活動をログ記録
- **ユーザーロギング**: 特定のデータベースユーザーの活動をログ記録
- **グローバルロギング**: データベース全体の活動をログ記録
- **オブジェクトロギング**: 特定のデータベースオブジェクトに関連するイベントをログ記録

### セッションモードのカテゴリ

| カテゴリ | ログ記録対象 | 説明 |
|----------|--------------|-------------|
| `read` | データ取得（SELECT、COPY） | データアクセスを追跡 |
| `write` | データ変更（INSERT、DELETE、UPDATE） | データベースの変更を追跡 |
| `function` | 関数とプロシージャの実行 | ルーチンの実行を追跡 |
| `role` | ユーザー管理操作 | 権限の変更を追跡 |
| `ddl` | スキーマ変更 | データベース構造の変更を監視 |
| `misc` | 一般的でないコマンド | 特殊な操作を記録 |
| `all` | すべて | 包括的なロギング |

## 設定例

### セッションロギング

```sql
-- デフォルトでは、PGAuditは何もログ記録しません
show pgaudit.log;

-- 特定のカテゴリのログ記録を設定
set pgaudit.log = 'ddl';
set pgaudit.log = 'read, ddl';
set pgaudit.log = 'none';
```

### ユーザーロギング

```sql
-- ユーザーを作成してログ記録を設定
create user "zapier" with password '<new password>';
alter role "zapier" set pgaudit.log to 'all';

-- ログ記録を無効化
alter role "zapier" set pgaudit.log to 'none';
```

### グローバルロギング

グローバルロギングの詳細については、PGAuditの公式ドキュメントを参照してください。
