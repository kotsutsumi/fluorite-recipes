# PostgreSQLのインデックス管理

## 概要

インデックスは、データの「目次」のような役割を果たすデータベースパフォーマンス最適化技術です。主なポイント:

- クエリがテーブル全体をスキャンせずに行を素早く見つけるのに役立ちます
- 最も一般的なタイプはB-Treeインデックスです
- クエリパフォーマンスを向上させますが、書き込みとストレージのオーバーヘッドが伴います

## インデックスの作成

### テーブル構造の例

```sql
create table persons (
  id bigint generated by default as identity primary key,
  age int,
  height int,
  weight int,
  name text,
  deceased boolean
);
```

### 基本的なインデックス作成

シンプルなB-Treeインデックスを作成するには:

```sql
create index idx_persons_age on persons (age);
```

### 重要な考慮事項

- インデックスがない場合、PostgreSQLは一致を見つけるために全ての行をスキャンします
- 書き込みをブロックしないように`create index concurrently`を使用します
- インデックス走査は、全テーブルスキャン(O(n))と比較して、より効率的です(O(log n))

## インデックスの種類とバリエーション

### 部分インデックス

データの特定のサブセットのインデックスを作成:

```sql
create index idx_living_persons_age on persons (age)
where deceased is false;
```

### 順序付きインデックス

インデックスのソート順をカスタマイズ（昇順/降順、NULLの配置）:

```sql
create index idx_persons_age_desc on persons (age desc nulls last);
```

### 再インデックス

パフォーマンスを維持するためにインデックスを再構築:

```sql
reindex index concurrently idx_persons_age;
reindex table concurrently persons;
```

## Supabaseインデックスアドバイザー

- ダッシュボードで潜在的なインデックスを提案します
- クエリパフォーマンスの最適化に役立ちます
- 推定される改善コストを提供します

### 使用方法

1. クエリパフォーマンスページに移動
2. クエリをクリック
3. インデックスタブを選択
4. インデックスアドバイザーを有効にする

## 重要なポイント

- インデックスはクエリを高速化します
- クエリパターンに基づいてインデックスを選択します
- パフォーマンスとストレージのトレードオフを考慮します
- インデックスアドバイザーなどのツールを使用して最適化します
