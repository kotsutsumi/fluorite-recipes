# タイムアウト

## 概要

- より長いトランザクションを実行するためにデータベースタイムアウトを延長
- ダッシュボードとクライアントクエリの最大設定可能タイムアウトは60秒
- より長いトランザクションの場合は、Supavisorまたは直接接続を使用

## Postgresタイムアウトを変更する方法

### 1. セッションレベル

- 接続の期間中のみ持続
- コマンド例: `set statement_timeout = '10min';`
- Supavisorセッションモードまたは直接接続でのみ機能
- 長時間実行される管理タスクに便利

### 2. 関数レベル

- Database REST APIとSupabaseクライアントライブラリで動作
- 特定の関数にカスタムタイムアウトを設定可能
- ランタイム免除が必要な定期的な関数に便利

### 3. ロールレベル

- 特定のロールのタイムアウトを設定
- デフォルトのロールタイムアウト:
  - `anon`: 3秒
  - `authenticated`: 8秒
  - `service_role`: なし（authenticatorロールの8秒にデフォルト）
  - `postgres`: なし（2分に制限）

### 4. グローバルレベル

- 明示的なタイムアウトのないすべてのロールのステートメントタイムアウトを変更
- 例: `alter database postgres set statement_timeout TO '4s';`

## タイムアウトの特定

### ログエクスプローラー

- ログエクスプローラーに移動して、タイムアウトしたイベントと長時間実行されるクエリを特定

### クエリパフォーマンスページ

- ロールとクエリ速度でフィルタリング
- 遅い実行だが成功したクエリを特定

### ログでのロールの理解

- 各APIサーバーは指定されたデータベースユーザーを使用
- ロールには以下が含まれます: `supabase_admin`、`authenticator`、`supabase_auth_admin`など

このドキュメントは、Supabaseでデータベースクエリのタイムアウトを管理するための包括的なガイダンスを提供します。
