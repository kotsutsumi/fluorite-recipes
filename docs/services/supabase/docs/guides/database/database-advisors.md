# パフォーマンスとセキュリティアドバイザー

## 概要

データベースパフォーマンスおよびセキュリティアドバイザーは、データベースにさまざまな問題がないかチェックするのに役立ちます:
- 欠落しているインデックス
- 不適切に設定されたRLSポリシー
- セキュリティの脆弱性

## アドバイザーの使用

Supabaseダッシュボードで、次に移動します:
- セキュリティアドバイザー
- パフォーマンスアドバイザー

アドバイザーは自動的に実行され、問題を解決した後に手動で再実行できます。

## 利用可能なチェック

### 0001 インデックスのない外部キー

**レベル: INFO**

#### 理論的根拠

外部キー列のインデックス作成は、リレーショナルデータベースでクエリパフォーマンスを向上させるための標準的な手法です。

#### 外部キーとは？

外部キーは、テーブル間の関係を強制し、参照整合性を保証する制約です。

#### 外部キー列をインデックス化する理由

インデックス作成により、結合パフォーマンスが向上し、データベースリソースの消費が削減されます。

#### 解決方法

外部キー列にインデックスを作成:

```sql
create index ix_book_author_id on book(author_id);
```

### 0002 認証ユーザーが公開されている

**レベル: ERROR**

#### 理論的根拠

ビューで`auth.users`を参照すると、機密性の高いユーザーデータが誤って公開される可能性があります。

#### 推奨される解決策

1. `auth.users`にトリガーを作成して、公開プロファイルテーブルを設定する
2. `auth.users`でRLSを使用したセキュリティinvokerビューを使用する

### 0003 認証RLS InitPlan

**レベル: WARN**

#### 理論的根拠

不適切に記述されたRLSポリシーは、各行に対して認証関数を実行することでパフォーマンスのボトルネックを引き起こす可能性があります。

#### パフォーマンスの最適化

認証関数呼び出しをサブクエリでラップして、結果をキャッシュし、関数実行のオーバーヘッドを削減します。

### その他のチェック

ドキュメントには、次のような他のいくつかのチェックがリストされています:
- プライマリキーなし
- 未使用のインデックス
- 複数の許可ポリシー
- RLS設定の問題
- 拡張機能のバージョンチェック

## 結論

パフォーマンスおよびセキュリティアドバイザーは、データベース設計とセキュリティの問題を特定して解決するための包括的なツールを提供します。
