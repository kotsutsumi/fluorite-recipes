# WAF システムバイパスルール

WAFシステムバイパスルールは、[Enterprise](/docs/plans/enterprise)および[Pro](/docs/plans/pro)プランで利用可能です。

Vercelのシステムレベルの緩和策（[DDoSプロテクション](/docs/security/ddos-mitigation)など）は、Webサイトやアプリケーションを保護しますが、プロキシや共有ネットワークからの通信が悪意のあるトラフィックとして識別される状況が発生することがあります。

システムバイパスルールを使用することで、特定のIPアドレスまたはCIDRレンジがVercelファイアウォールのシステム緩和策によって決して遮断されないようにできます。

独自の[WAFカスタムルール](/docs/vercel-waf/custom-rules)によってブロックされたリクエストを許可する必要がある場合は、[バイパスアクションを持つ別のカスタムルール](/docs/vercel-firewall/vercel-waf/managed-rulesets#bypassing-custom-rules)を使用してください。

## はじめに

システムバイパスを適用するIPアドレスを追加するには、プロジェクトのファイアウォールタブに移動し、以下の手順に従います：

1. 右上の「Configure」を選択
2. システムバイパスルールセクションまでスクロール
3. 「+ Add Rule」ボタンを選択
4. 「Configure New System Bypass」モーダルで以下のフィールドを入力：
   - **IP Address Or CIDR**（必須）：バイパスするIPアドレスまたはCIDR範囲
   - **Domain**（必須）：プロジェクトに接続されているドメインまたは`*`を使用してプロジェクトに接続されているすべてのドメインに適用
   - **Note**（オプション）：このルールの目的を説明するメモ
5. 「Create System Bypass Rule」ボタンを選択
6. 変更を確認し、「Publish」を選択して適用

## システムバイパスの使用例

### 企業VPNの許可

```
IP Address: 203.0.113.0/24
Domain: *
Note: Corporate VPN network
```

### CDNプロバイダーの許可

```
IP Address: 198.51.100.0/24
Domain: www.example.com
Note: Cloudflare proxy IPs
```

### パートナーAPIサーバーの許可

```
IP Address: 192.0.2.50
Domain: api.example.com
Note: Partner integration server
```

## 重要な注意事項

### セキュリティ上の考慮事項

- システムバイパスルールは、DDoS緩和を含むすべてのシステムレベルの保護をバイパスします
- 信頼できるIPアドレスのみを追加してください
- 可能な限り具体的なCIDR範囲を使用してください
- 定期的にバイパスリストを見直し、不要なエントリを削除してください

### カスタムルールとの関係

- システムバイパスルールは、カスタムWAFルールよりも優先されます
- カスタムルールによるブロックを回避する必要がある場合は、バイパスアクションを持つカスタムルールを使用してください
- システムバイパスは、システムレベルの保護のみをバイパスします

### ドメインの指定

- 特定のドメインにのみ適用する場合は、正確なドメイン名を指定
- すべてのドメインに適用する場合は、`*`を使用
- サブドメインには個別のエントリが必要

## ベストプラクティス

1. **最小権限の原則**: 必要最小限のIPアドレス範囲のみをバイパス
2. **明確なドキュメント化**: 各バイパスルールの目的をメモフィールドに記録
3. **定期的なレビュー**: 月次または四半期ごとにバイパスリストを確認
4. **モニタリング**: バイパスされたIPアドレスからのトラフィックを監視
5. **代替手段の検討**: 可能であれば、カスタムルールのバイパスアクションを使用

## トラブルシューティング

### バイパスが機能しない場合

1. IPアドレスまたはCIDR範囲が正しく入力されているか確認
2. ドメイン指定が正しいか確認
3. 変更が公開されているか確認
4. ファイアウォールログでリクエストがどのように処理されているか確認

### 誤ってバイパスされている場合

1. バイパスリストを確認し、不要なエントリを削除
2. CIDR範囲が広すぎないか確認
3. ワイルドカード（`*`）の使用が適切か確認

詳細については、[Vercelサポート](https://vercel.com/support)にお問い合わせください。
