# 保護されたGitスコープ

## 概要

保護されたGitスコープは、[エンタープライズプラン](/docs/plans/enterprise)で利用可能な機能です。

[所有者](/docs/rbac/access-roles#owner-role)ロールを持つユーザーのみがこの機能にアクセスできます。

この機能により、特定のVercelチームのみがGitリポジトリからデプロイできるように制限できます。複数のチームの所有者である場合、同じスコープを各Vercelチームに割り当てることで、すべてのチームがリポジトリをデプロイできるようになります。

## 主な用途

- **セキュリティ強化**：認可されたチームのみがリポジトリをデプロイ可能
- **アクセス制御**：組織内の異なるチーム間でリポジトリへのアクセスを管理
- **コンプライアンス**：企業のセキュリティポリシーに準拠

## 保護されたGitスコープの管理

### 制限事項

- Vercelチームには最大5つの保護されたGitスコープを追加できます
- 複数のチームが同じスコープを指定できます
- スコープは、GitHubの組織、GitLabのグループ、またはBitbucketのワークスペースに対応します

### 追加の要件

スコープを追加するには、Git provider側で適切な権限が必要です：

| Git Provider | 必要な権限 |
|-------------|-----------|
| GitHub      | `admin`   |
| GitLab      | `owner`   |
| Bitbucket   | `owner`   |

## 保護されたGitスコープの追加手順

### 1. 設定ページに移動

1. チームのダッシュボードから、設定したいプロジェクトを選択
2. 上部メニューから「Settings」タブをクリック
3. サイドメニューから「Security & Privacy」を選択
4. 「Protected Git Scopes」セクションまでスクロール

### 2. スコープを追加

1. 「Add」ボタンをクリック
2. モーダルウィンドウが表示される

### 3. スコープの設定

モーダルウィンドウで以下を選択：

1. **Git Provider**を選択
   - GitHub
   - GitLab
   - Bitbucket

2. **Git Namespace**を選択
   - GitHub：組織名（例：`my-organization`）
   - GitLab：グループ名（例：`my-group`）
   - Bitbucket：ワークスペース名（例：`my-workspace`）

3. 「Save」をクリックして保存

### 例：GitHubでの設定

```
Git Provider: GitHub
Git Namespace: acme-corporation
```

これにより、`acme-corporation`組織のリポジトリのみが、このVercelチームでデプロイ可能になります。

## 保護されたGitスコープの削除手順

### 1. 設定ページに移動

1. チームのダッシュボードから、プロジェクトを選択
2. 「Settings」→「Security & Privacy」に移動
3. 「Protected Git Scopes」セクションを表示

### 2. スコープを削除

1. 削除したいスコープの横にある「Remove」ボタンをクリック
2. 確認ダイアログで「Remove」を再度クリック

## 複数のチームでの共有

同じGitスコープを複数のVercelチームに割り当てることができます。

### 使用例

**シナリオ：**
- チームA：フロントエンド開発チーム
- チームB：バックエンド開発チーム
- 両チームが同じGitHub組織`acme-corp`のリポジトリをデプロイ

**設定：**

1. チームAで`acme-corp`スコープを追加
2. チームBでも同じ`acme-corp`スコープを追加
3. 両チームが`acme-corp`組織のリポジトリをデプロイ可能

## ベストプラクティス

### 1. 最小権限の原則

必要最小限のスコープのみを追加：

- チームが実際にアクセスする必要があるGit名前空間のみを追加
- 不要になったスコープは削除

### 2. 定期的なレビュー

保護されたGitスコープを定期的にレビュー：

- チームメンバーの変更に応じてスコープを更新
- 使用されていないスコープを削除
- 新しいプロジェクトに応じて追加

### 3. ドキュメント化

どのチームがどのスコープにアクセスできるかをドキュメント化：

```markdown
# Gitスコープ管理

## フロントエンドチーム
- GitHub: `frontend-org`
- GitLab: `frontend-group`

## バックエンドチーム
- GitHub: `backend-org`
- GitLab: `backend-group`

## 共有チーム
- GitHub: `shared-org`
```

### 4. アクセス監査

定期的にアクセスログを確認：

1. Vercelダッシュボードの「Audit Log」に移動
2. Gitスコープに関連するアクティビティを確認
3. 不正なアクセス試行がないかチェック

## トラブルシューティング

### スコープを追加できない

**原因：** Git provider側で適切な権限がない

**解決策：**

1. Git provider（GitHub、GitLab、Bitbucket）で自分の権限を確認
2. 組織/グループ/ワークスペースの所有者に権限を依頼
3. 権限を取得後、再度スコープを追加

### リポジトリをデプロイできない

**原因：** リポジトリの名前空間が保護されたGitスコープに含まれていない

**解決策：**

1. リポジトリがどのGit名前空間に属しているか確認
2. その名前空間を保護されたGitスコープに追加
3. デプロイを再試行

### 複数のチームで同じリポジトリにアクセスしたい

**解決策：**

各チームで同じGitスコープを追加：

1. チームAの設定で`my-org`スコープを追加
2. チームBの設定でも`my-org`スコープを追加
3. 両チームが`my-org`のリポジトリにアクセス可能

## セキュリティ上の注意点

### 1. スコープの範囲

保護されたGitスコープは、Git名前空間全体（組織/グループ/ワークスペース）に適用されます。個別のリポジトリレベルでの制限はできません。

### 2. 権限の委譲

Vercelチームの所有者は、保護されたGitスコープを管理できます。所有者ロールの割り当てには注意してください。

### 3. Git provider側の権限

保護されたGitスコープを追加しても、Git provider側の権限が変更されるわけではありません。チームメンバーがGit providerでリポジトリにアクセスできる必要があります。

## 使用例

### 例1：単一組織の保護

```
チーム: Frontend Team
保護されたGitスコープ:
  - GitHub: acme-corp
```

`Frontend Team`は、`acme-corp`組織のリポジトリのみをデプロイできます。

### 例2：複数の名前空間

```
チーム: Full Stack Team
保護されたGitスコープ:
  - GitHub: acme-corp
  - GitHub: acme-oss
  - GitLab: acme-internal
```

`Full Stack Team`は、複数のGit名前空間からリポジトリをデプロイできます。

### 例3：複数チームでの共有

```
チームA: Development Team
保護されたGitスコープ:
  - GitHub: acme-corp

チームB: QA Team
保護されたGitスコープ:
  - GitHub: acme-corp
```

両チームが同じ`acme-corp`組織のリポジトリにアクセスできます。

## 監査とコンプライアンス

### 監査ログの確認

Enterpriseプランでは、保護されたGitスコープの変更を監査ログで確認できます：

1. チームダッシュボードに移動
2. 「Settings」→「Audit Log」を選択
3. 「Protected Git Scopes」に関連するイベントをフィルタ

### コンプライアンスレポート

定期的にレポートを生成：

- どのチームがどのGit名前空間にアクセスしているか
- スコープの変更履歴
- アクセス試行の記録

## 関連リンク

- [セキュリティとプライバシー](/docs/security)
- [アクセスロール](/docs/rbac/access-roles)
- [監査ログ](/docs/security/audit-logs)
- [Gitインテグレーション](/docs/git)
- [Enterpriseプラン](/docs/plans/enterprise)
