# Two-Factor Authentication (2FA) - 2要素認証

## 概要

Vercelアカウントのセキュリティを強化するための2要素認証（2FA）機能について説明します。2FAは、パスワードに加えて第2の認証要素を要求することで、アカウントを不正アクセスから保護します。

## 2FAの方法

Vercelでは2つの認証方法を提供しています：

### 1. 認証アプリ（TOTP）

**Time-based One-Time Password（時間ベースのワンタイムパスワード）**

- Google Authenticator
- Authy
- Microsoft Authenticator
- 1Password
- その他のTOTPアプリ

**特徴**:
- 時間ベースの6桁のコードを生成
- インターネット接続不要
- デバイスにローカルで保存

### 2. パスキー

**WebAuthn互換デバイス**

- セキュリティキー（YubiKey、Titan Keyなど）
- 生体認証デバイス（Touch ID、Face ID、指紋認証など）
- Windows Hello
- プラットフォーム認証（デバイス組み込みの認証）

**特徴**:
- フィッシング耐性
- パスワードレス認証
- 高いセキュリティレベル

## 2FAの有効化手順

### 認証アプリ（TOTP）の設定

#### 手順

1. Vercelの[アカウント設定](https://vercel.com/account/settings/authenticate#two-factor-authentication)に移動
2. 「Two-Factor Authentication」セクションを見つける
3. 2FAスイッチをオンに切り替え
4. 「Authenticator App」を選択
5. QRコードが表示される
6. 認証アプリでQRコードをスキャン：
   - Google Authenticatorを開く
   - 「+」ボタンをタップ
   - 「QRコードをスキャン」を選択
   - 表示されたQRコードをスキャン
7. 認証アプリに表示された6桁のコードを入力
8. 「Verify」をクリック
9. 回復コードをダウンロードして安全に保管
10. 「Continue」をクリックして完了

#### 使用方法

ログイン時：
1. メールアドレスとパスワードを入力
2. 認証アプリに表示された6桁のコードを入力
3. 「Verify」をクリック

### パスキーの設定

#### 手順

1. Vercelの[アカウント設定](https://vercel.com/account/settings/authenticate#two-factor-authentication)に移動
2. 「Two-Factor Authentication」セクションを見つける
3. 2FAスイッチをオンに切り替え
4. 「Passkey」を選択
5. ブラウザまたはOSの指示に従って認証：
   - セキュリティキーを挿入（該当する場合）
   - 生体認証（Touch ID、Face ID等）
   - PINコードを入力
6. 認証が完了すると、パスキーが登録される
7. 回復コードをダウンロードして安全に保管
8. 「Continue」をクリックして完了

#### 使用方法

ログイン時：
1. メールアドレスとパスワードを入力
2. パスキー認証を要求されたら、デバイスで認証：
   - セキュリティキーをタッチ
   - 生体認証を使用
   - PINコードを入力

## 回復コード

### 概要

回復コードは、2FA デバイスにアクセスできなくなった場合のバックアップ方法です。

### 特徴

- **ワンタイム**: 各回復コードは1回のみ使用可能
- **複数コード**: 10個の回復コードが生成される
- **再生成可能**: いつでも新しいコードセットを生成可能

### 保管方法

回復コードは以下の方法で安全に保管してください：

1. **パスワードマネージャー**: 1Password、LastPassなど
2. **暗号化されたノート**: 暗号化されたドキュメント
3. **物理的なコピー**: 安全な場所に印刷して保管
4. **セキュアなクラウドストレージ**: 暗号化されたクラウドストレージ

### 使用方法

2FAデバイスにアクセスできない場合：

1. ログインページでメールアドレスとパスワードを入力
2. 2FA コード入力画面で「Use a recovery code」をクリック
3. 回復コードの1つを入力
4. 「Verify」をクリック

### 新しい回復コードの生成

1. [アカウント設定](https://vercel.com/account/settings/authenticate)に移動
2. 「Two-Factor Authentication」セクションを見つける
3. 「Regenerate Recovery Codes」をクリック
4. 新しいコードセットが生成される
5. ダウンロードして安全に保管

**注意**: 新しいコードを生成すると、古いコードは無効になります。

## チームでの2FA強制

### 概要

チーム管理者は、全メンバーに2FAを強制できます。これにより、チーム全体のセキュリティレベルが向上します。

### 設定方法

1. チームダッシュボードに移動
2. 「設定」タブを選択
3. 「セキュリティとプライバシー」セクションに移動
4. 「2要素認証の強制」トグルをオンに切り替え
5. 確認ダイアログで設定を確認

### 影響

2FA強制を有効にすると：

- すべての既存メンバーが2FAを設定する必要がある
- 2FAを設定していないメンバーは、次回ログイン時に設定を要求される
- 2FAを設定するまで、チームリソースにアクセスできない
- 新しいメンバーも招待受諾時に2FAを設定する必要がある

### 猶予期間

管理者は、メンバーに2FAを設定するための猶予期間を設定できます：

- 即時（デフォルト）
- 7日間
- 14日間
- 30日間

詳細は[Two-Factor Enforcement](/docs/two-factor-enforcement)ドキュメントを参照してください。

## 2FAの無効化

### 手順

1. [アカウント設定](https://vercel.com/account/settings/authenticate)に移動
2. 「Two-Factor Authentication」セクションを見つける
3. 2FAスイッチをオフに切り替え
4. 確認ダイアログで無効化を確認

### 注意事項

- 2FAを無効化すると、アカウントのセキュリティが低下します
- チームで2FAが強制されている場合、無効化できません
- 回復コードも無効になります

## トラブルシューティング

### 問題1: 認証アプリのコードが機能しない

**原因**:
- デバイスの時刻が正しくない
- 間違ったコードを入力している

**解決策**:
1. デバイスの時刻設定を確認（自動時刻設定を有効化）
2. 新しいコードを待って再試行
3. QRコードを再スキャン

### 問題2: パスキーが認識されない

**原因**:
- ブラウザがWebAuthnをサポートしていない
- デバイスが認証をブロックしている

**解決策**:
1. 最新のブラウザを使用（Chrome、Firefox、Safari、Edge）
2. デバイスの認証設定を確認
3. 別のパスキーデバイスを試す

### 問題3: 2FAデバイスを紛失した

**解決策**:
1. 回復コードを使用してログイン
2. ログイン後、新しい2FAデバイスを設定
3. 紛失したデバイスを削除

### 問題4: 回復コードも失った

**解決策**:
1. Vercelサポートに連絡（support@vercel.com）
2. アカウント所有権を証明する情報を提供：
   - 登録メールアドレス
   - プロジェクト名
   - 最近のアクティビティ情報
3. サポートチームがアカウント復旧をサポート

## セキュリティベストプラクティス

### 1. 複数の2FA方法を設定

認証アプリとパスキーの両方を設定することを推奨：

```
メイン: パスキー（高セキュリティ）
バックアップ: 認証アプリ
緊急: 回復コード
```

### 2. 回復コードの安全な保管

- パスワードマネージャーに保管
- 複数の安全な場所に保管
- 定期的に回復コードを確認

### 3. デバイスのセキュリティ

- 2FAデバイスを安全に保管
- デバイスにパスコードを設定
- 紛失時の対応計画を準備

### 4. 定期的な見直し

- 使用していない2FAデバイスを削除
- 回復コードを定期的に再生成
- 2FA設定を定期的に確認

## 2FAの比較

| 特徴 | 認証アプリ（TOTP） | パスキー |
|-----|-------------------|---------|
| セキュリティレベル | 高 | 非常に高 |
| フィッシング耐性 | 低 | 高 |
| 使いやすさ | 中 | 高 |
| インターネット要否 | 不要 | 不要 |
| バックアップ | 可能 | デバイス依存 |
| コスト | 無料 | 無料〜有料（ハードウェアキー） |

## ユースケース

### 個人開発者

**推奨設定**:
- 認証アプリ（Google Authenticator等）
- 回復コードを安全に保管

### 小規模チーム

**推奨設定**:
- 認証アプリまたはパスキー
- チームで2FA強制を有効化
- 回復コードの保管手順を文書化

### 大規模エンタープライズ

**推奨設定**:
- パスキー（ハードウェアセキュリティキー）
- SAML SSOと組み合わせてMFAを強制
- 厳格な回復手順を策定

## 関連リソース

- [Two-Factor Enforcement](/docs/two-factor-enforcement)
- [パスキー](/docs/passkeys)
- [SAML SSO](/docs/saml)
- [アカウントセキュリティ](/docs/security/account-security)
- [セキュリティベストプラクティス](/docs/security)

## よくある質問

### Q: 2FAは必須ですか？

A: 個人アカウントでは任意ですが、チーム管理者が強制することができます。セキュリティ上、有効化を強く推奨します。

### Q: 複数の2FAデバイスを登録できますか？

A: はい。認証アプリとパスキーを両方登録できます。また、複数のパスキーデバイスを登録することも可能です。

### Q: 2FAを有効にするとAPIトークンにも影響しますか？

A: いいえ。APIトークンは2FAの影響を受けません。ただし、トークンの管理には注意が必要です。

### Q: SMSベースの2FAはサポートされていますか？

A: いいえ。Vercelは、より安全な認証アプリとパスキーのみをサポートしています。

### Q: 2FAを設定するとログイン時間は長くなりますか？

A: 若干長くなりますが、パスキーを使用すると、むしろログインが高速になる場合があります。
