# Security Headers（セキュリティヘッダー）

セキュリティヘッダーは、Webアプリケーションのセキュリティを強化し、一般的な攻撃から保護するための重要なツールです。

## Content Security Policy (CSP)

Content Security Policy（コンテンツセキュリティポリシー）は、クロスサイトスクリプティング（XSS）やコードインジェクション攻撃を防止するためのブラウザ機能です。

### 概要

CSPは、信頼できるコンテンツソースの許可リストを定義することで、XSS脆弱性を軽減します。

### 主要機能

CSPは以下の方法でXSS脆弱性を軽減します:

1. **コンテンツソースの許可リスト化**
   - 信頼できるソースのみからコンテンツを読み込む

2. **インラインスクリプトのブロック**
   - デフォルトでインラインスクリプトの実行をブロック

3. **`eval()`関数の無効化**
   - 危険な`eval()`関数の使用を防止

4. **Nonceとハッシュベースの検証**
   - スクリプトとスタイルの検証をサポート

5. **違反レポート機能**
   - CSP違反を検出してレポート

6. **プラグインの制限**
   - プラグインの使用を制限

## CSPヘッダーの例

```
Content-Security-Policy: default-src 'self'; script-src 'self' cdn.example.com; img-src 'self' img.example.com; style-src 'self';
```

### このポリシーの意味

- **default-src 'self'**: サイト自身のオリジンからのコンテンツを許可
- **script-src 'self' cdn.example.com**: サイトのオリジンと指定されたCDNからのスクリプトを許可
- **img-src 'self' img.example.com**: サイトのオリジンと指定された画像ドメインからの画像を許可
- **style-src 'self'**: サイトのオリジンからのスタイルのみを許可

## ベストプラクティス

### 1. レポート専用モードから始める

```
Content-Security-Policy-Report-Only: default-src 'self';
```

最初は`Content-Security-Policy-Report-Only`ヘッダーを使用して、実際にブロックせずにポリシー違反をレポートします。

### 2. `unsafe-inline`と`unsafe-eval`を避ける

これらのディレクティブはCSPのセキュリティ効果を大幅に低下させます。

### 3. インラインスクリプト/スタイルにはNonceを使用

```html
<script nonce="random-nonce-value">
  // スクリプトコード
</script>
```

### 4. 許可するソースを具体的に指定

広範なワイルドカードの使用を避け、具体的なドメインを指定します。

### 5. ディレクティブを定期的に更新

アプリケーションの変更に応じてCSPディレクティブを更新します。

## 重要な注意事項

### 多層防御戦略の一部

CSPは強力なツールですが、以下のような他のセキュリティ対策と組み合わせる必要があります:

- 入力検証
- 出力エンコーディング
- その他のセキュリティベストプラクティス

### ブラウザ互換性

異なるブラウザでテストを行い、互換性を確認してください。

### 継続的なメンテナンス

CSPは設定して終わりではなく、継続的な更新とメンテナンスが必要です。

## まとめ

Content Security Policyは、Webアプリケーションのセキュリティを強化するための重要なツールです。適切に実装することで、XSSやコードインジェクション攻撃のリスクを大幅に軽減できます。
