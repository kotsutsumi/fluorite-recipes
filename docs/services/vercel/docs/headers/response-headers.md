# Response Headers（レスポンスヘッダー）

Vercelは、デプロイメントのレスポンスにいくつかのヘッダーを含めます。これらのヘッダーは、環境やキャッシングに関する情報を提供し、ブラウザの開発者ツールやHTTPクライアント（例: `curl`）で確認できます。

## 主要なレスポンスヘッダー

### 1. `cache-control`

ネットワークキャッシュとブラウザキャッシュのキャッシングディレクティブを指定します。

**デフォルト値**:

```
cache-control: public, max-age=0, must-revalidate
```

**意味**:
- `public`: レスポンスがキャッシュ可能
- `max-age=0`: ブラウザはキャッシュしない
- `must-revalidate`: キャッシュは常に検証が必要

詳細: [Cache-Control Headers](/docs/headers/cache-control-headers)

### 2. `content-length`

レスポンスのバイト数を示します。

**例**:

```
content-length: 1234
```

### 3. `content-type`

レスポンスのメディアタイプとフォーマットを説明します。

**一般的な値**:

```
content-type: text/html; charset=utf-8
content-type: application/json
content-type: image/png
```

### 4. `date`

レスポンスが生成された時刻のタイムスタンプを示します。

**例**:

```
date: Wed, 15 May 2024 12:00:00 GMT
```

### 5. `server: Vercel`

リクエストの送信元を示します。

**注意事項**:
- 他のプロキシによって上書きされる可能性があります

### 6. `strict-transport-security`

ブラウザにHTTPS経由でのみリソースをリクエストするよう指示します。

**デフォルト値**:

```
strict-transport-security: max-age=63072000
```

**意味**:
- `max-age=63072000`: 2年間（63,072,000秒）

**効果**:
- HTTPSへの自動アップグレード
- セキュアな接続の強制

### 7. `x-robots-tag`

プレビューデプロイメントと古い本番デプロイメントに存在します。

**目的**:
- 検索エンジンによるこれらのデプロイメントのクロールを防止

**無効化方法**:
- 本番ドメインを割り当てることで無効化可能

### 8. `x-vercel-cache`

キャッシュステータスを示します。

**可能な値**:

#### `MISS`

レスポンスがキャッシュに見つからなかった。

**意味**:
- オリジンサーバーから新しいレスポンスを取得
- レスポンスはキャッシュに保存される

#### `HIT`

レスポンスがキャッシュから配信された。

**意味**:
- キャッシュされたレスポンスを即座に返す
- オリジンサーバーへのリクエストなし

#### `STALE`

キャッシュされたレスポンスをバックグラウンド更新と共に配信。

**意味**:
- 古いキャッシュを即座に配信
- バックグラウンドでキャッシュを更新

#### `PRERENDER`

静的ストレージからのレスポンス。

**意味**:
- ビルド時に生成された静的コンテンツ
- キャッシュではなくストレージから配信

#### `REVALIDATED`

オリジンサーバーからのレスポンスでキャッシュを更新。

**意味**:
- キャッシュが更新された
- 新しいレスポンスを返す

### 9. `x-vercel-id`

リクエストが通過したVercelリージョンのリストを含みます。

**目的**:
- 無限ループの防止
- リクエストの追跡

## レスポンスヘッダーの確認方法

### ブラウザ開発者ツール

1. ブラウザの開発者ツールを開く（F12）
2. Networkタブを選択
3. リクエストを選択
4. Headersタブでレスポンスヘッダーを確認

### curlコマンド

```bash
curl -I https://example.com
```

**出力例**:

```
HTTP/2 200
cache-control: public, max-age=0, must-revalidate
content-type: text/html; charset=utf-8
date: Wed, 15 May 2024 12:00:00 GMT
server: Vercel
strict-transport-security: max-age=63072000
x-vercel-cache: HIT
x-vercel-id: iad1::12345-67890
```

## ユースケース

### 1. キャッシュパフォーマンスのモニタリング

`x-vercel-cache`ヘッダーを確認して、キャッシュの効率を評価:

- `HIT`率が高い = 効率的なキャッシュ
- `MISS`率が高い = キャッシュ戦略の見直しが必要

### 2. デバッグとトラブルシューティング

`x-vercel-id`を使用してリクエストの経路を追跡:

```
x-vercel-id: iad1::12345-67890::sfo1::abcde-fghij
```

この例では、リクエストがiad1とsfo1リージョンを通過したことがわかります。

### 3. セキュリティ検証

`strict-transport-security`ヘッダーが正しく設定されているか確認:

```
strict-transport-security: max-age=63072000
```

### 4. 検索エンジン最適化（SEO）

`x-robots-tag`ヘッダーを確認して、検索エンジンのクロール設定を検証。

## ベストプラクティス

### 1. キャッシュヘッダーの最適化

適切な`cache-control`ヘッダーを設定して、パフォーマンスを最大化します。

### 2. セキュリティヘッダーの監視

`strict-transport-security`などのセキュリティヘッダーが正しく設定されているか定期的に確認します。

### 3. キャッシュパフォーマンスの追跡

`x-vercel-cache`ヘッダーを定期的に監視して、キャッシュ効率を最適化します。

### 4. デバッグ情報の活用

`x-vercel-id`を使用して、問題のあるリクエストを追跡し、トラブルシューティングを効率化します。

これらのレスポンスヘッダーを理解し活用することで、Webアプリケーションのパフォーマンス、セキュリティ、デバッグ能力を向上させることができます。
