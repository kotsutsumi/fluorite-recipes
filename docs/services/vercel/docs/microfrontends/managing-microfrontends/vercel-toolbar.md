# Vercelツールバーを使用したマイクロフロントエンドの管理

## マイクロフロントエンド（ベータ版）

### マイクロフロントエンドの表示

[Vercelツールバー](/docs/vercel-toolbar)を使用すると、マイクロフロントエンドを分離して視覚化および独立してテストできます。ツールバーのマイクロフロントエンドパネルには、`microfrontends.json`で[設定したすべてのマイクロフロントエンド](/docs/microfrontends/quickstart#define-microfrontends.json)が表示されます。

> **注意**: これには`@vercel/toolbar`パッケージのバージョン0.1.33以降が必要です。

## 機能

### すべてのマイクロフロントエンドの表示

ツールバーのマイクロフロントエンドパネルには、マイクロフロントエンドグループ内のすべてのマイクロフロントエンドが表示されます。各マイクロフロントエンドをクリックすると、対応するVercelプロジェクトに関する情報を確認したり、アクションを実行したりできます。

#### 表示される情報

- プロジェクト名
- 現在のデプロイメントバージョン
- ルーティングパス
- デプロイメント状態

### マイクロフロントエンドゾーンインジケーター

複数のマイクロフロントエンドが同じドメインでコンテンツを提供する場合、どのアプリケーションがページを提供しているかを追跡するのは困難です。ゾーンインジケーターを使用すると、マイクロフロントエンドが提供しているアプリケーションと環境の名前を表示できます。

#### ゾーンインジケーターの使用方法

1. Vercelツールバーを開く
2. マイクロフロントエンドパネルを表示
3. 「ゾーンインジケーターを表示」オプションを有効化
4. ページ上でマイクロフロントエンドの境界が視覚的に表示される

### ルーティングのオーバーライド

マイクロフロントエンドの開発中、他の依存関係なしに特定のマイクロフロントエンドのみをテストしたい場合があります。ルーティングオーバーライド機能を使用すると、特定のパスのルーティング先を一時的に変更できます。

#### 使用方法

1. Vercelツールバーを開く
2. マイクロフロントエンドパネルに移動
3. オーバーライドしたいマイクロフロントエンドを選択
4. 「ルーティングをオーバーライド」ボタンをクリック
5. 新しいルーティング先（ローカルまたはリモートURL）を入力

#### 例：ローカルマイクロフロントエンドへのオーバーライド

```
元のルーティング: /docs → https://docs.example.com
オーバーライド後: /docs → http://localhost:3001
```

これにより、`/docs`へのすべてのリクエストがローカルで実行中の開発サーバーにリダイレクトされます。

### デプロイメント情報の表示

各マイクロフロントエンドの詳細情報を確認できます：

- 現在のデプロイメントURL
- デプロイメント時刻
- Gitコミット情報
- 環境（本番、プレビュー、開発）

### クイックアクション

ツールバーから直接実行できるアクション：

- **プロジェクトを開く**：Vercelダッシュボードでプロジェクトを開く
- **デプロイメントを表示**：現在のデプロイメントの詳細を表示
- **ログを確認**：デプロイメントログを表示
- **再デプロイ**：最新のコミットを再デプロイ

## セットアップ

### Vercelツールバーのインストール

各マイクロフロントエンドプロジェクトにツールバーをインストールします：

```bash
npm install @vercel/toolbar
```

### Next.jsでの設定

```javascript
// app/layout.js
import { VercelToolbar } from '@vercel/toolbar/next';

export default function RootLayout({ children }) {
  const shouldInjectToolbar = process.env.NODE_ENV === 'development';

  return (
    <html lang="ja">
      <body>
        {children}
        {shouldInjectToolbar && <VercelToolbar />}
      </body>
    </html>
  );
}
```

### Reactでの設定

```javascript
// App.jsx
import { VercelToolbar } from '@vercel/toolbar/react';

function App() {
  return (
    <div>
      <YourApp />
      {process.env.NODE_ENV === 'development' && <VercelToolbar />}
    </div>
  );
}
```

## ベストプラクティス

### 開発環境でのみ有効化

本番環境ではツールバーを無効にします：

```javascript
const shouldInjectToolbar =
  process.env.NODE_ENV === 'development' ||
  process.env.VERCEL_ENV === 'preview';
```

### チーム全体での一貫性

すべてのマイクロフロントエンドで同じバージョンのツールバーを使用します：

```json
{
  "dependencies": {
    "@vercel/toolbar": "^0.1.33"
  }
}
```

### ゾーンインジケーターの活用

複雑なマイクロフロントエンド構成では、ゾーンインジケーターを常に有効にして、どのアプリケーションがどのコンテンツを提供しているかを明確にします。

## トラブルシューティング

### ツールバーが表示されない

- `@vercel/toolbar`パッケージが正しくインストールされているか確認
- バージョンが0.1.33以降であるか確認
- 開発モードで実行しているか確認
- ブラウザのコンソールでエラーを確認

### ルーティングオーバーライドが機能しない

- ローカルサーバーが実行されているか確認
- ポートが正しいか確認
- ブラウザのキャッシュをクリア
- ツールバーを再読み込み

### ゾーンインジケーターが不正確

- `microfrontends.json`が最新であるか確認
- デプロイメントが最新の設定を反映しているか確認
- ブラウザをリフレッシュ

## 関連リンク

- [Vercelツールバーの概要](/docs/vercel-toolbar)
- [マイクロフロントエンドの管理](/docs/microfrontends/managing-microfrontends)
- [ローカル開発](/docs/microfrontends/local-development)
- [トラブルシューティング](/docs/microfrontends/troubleshooting)
