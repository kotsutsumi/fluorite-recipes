# Gitブランチへのドメインの割り当て

特定のGitブランチにドメインを割り当てる方法を説明します。

## 概要

接続されたGitリポジトリの本番ブランチにプッシュされたすべてのコミットには、プロジェクトで設定されたドメインが割り当てられます。

ProおよびEnterpriseチームは、カスタム環境のブランチトラッキングを設定できます。

## Gitブランチにドメインを割り当てる手順

### ダッシュボードでの設定

1. **プロジェクトダッシュボードに移動**
2. **Settingsタブを選択**
3. **Domainsメニュー項目をクリック**
4. **目的のドメインのEdit ドロップダウンを選択**
5. **「Connect to an environment」セクションで「Preview」を選択**
6. **Git Branchフィールドに特定のブランチ名を入力**

### APIを使用した設定

Vercel REST APIの「Update a project domain」PATCHエンドポイントを使用することもできます。

**API エンドポイント**:
```
PATCH /v9/projects/{projectId}/domains/{domain}
```

## ユースケース

### 1. ステージング環境

**設定例**:
- ドメイン: `staging.example.com`
- ブランチ: `staging`

**効果**:
- `staging`ブランチへのデプロイが`staging.example.com`で公開される

### 2. 開発環境

**設定例**:
- ドメイン: `dev.example.com`
- ブランチ: `develop`

**効果**:
- `develop`ブランチへのデプロイが`dev.example.com`で公開される

### 3. 機能ブランチのプレビュー

**設定例**:
- ドメイン: `feature.example.com`
- ブランチ: `feature/new-ui`

**効果**:
- 特定の機能ブランチを固定ドメインでプレビュー可能

### 4. A/Bテスト環境

**設定例**:
- ドメイン: `variant-a.example.com`
- ブランチ: `ab-test/variant-a`

**効果**:
- 異なるバージョンを異なるドメインでテスト可能

## 設定の詳細

### 本番ブランチ

デフォルトでは、本番ブランチ（通常は`main`または`master`）へのコミットが本番ドメインに割り当てられます。

**自動動作**:
```
main ブランチ → example.com, www.example.com
```

### プレビューブランチ

特定のブランチをプレビュードメインに割り当てることができます。

**手動設定**:
```
staging ブランチ → staging.example.com
develop ブランチ → dev.example.com
```

## ブランチへのドメイン割り当て後の動作

### 新しいデプロイメントの必要性

ドメインを異なるブランチに割り当てる場合、正しく解決されるように新しいデプロイメントが必要です。

**手順**:
1. ドメインをブランチに割り当て
2. 該当ブランチに変更をプッシュ
3. 新しいデプロイメントが作成される
4. ドメインが新しいデプロイメントを指す

### ロールバック

ロールバックは即座に反映され、カスタムドメインが前のデプロイメントに割り当てられます。

## ベストプラクティス

### 1. 明確な命名規則

環境とブランチの関係が明確になるような命名規則を使用します。

**推奨**:
```
本番: main → example.com
ステージング: staging → staging.example.com
開発: develop → dev.example.com
```

### 2. 環境ごとの環境変数

各環境に適切な環境変数を設定します。

**例**:
- 本番: 本番データベース、本番APIキー
- ステージング: ステージングデータベース、テストAPIキー
- 開発: 開発データベース、開発APIキー

### 3. デプロイ前のテスト

プレビュードメインでテストしてから、本番にマージします。

**ワークフロー**:
1. 機能ブランチで開発
2. `develop`ブランチにマージ → `dev.example.com`で確認
3. `staging`ブランチにマージ → `staging.example.com`で確認
4. `main`ブランチにマージ → `example.com`で公開

### 4. アクセス制御

プレビュー環境には、適切なアクセス制御を実装します。

**実装例（Vercel Password Protection）**:

Vercel Proプランでは、プレビューデプロイメントにパスワード保護を設定できます。

## トラブルシューティング

### ドメインが新しいブランチを指さない

1. **新しいデプロイメントの作成**: ブランチに変更をプッシュ
2. **DNS伝播の確認**: DNSキャッシュのクリア
3. **設定の確認**: ダッシュボードでドメインの割り当てを確認

### 複数のブランチが同じドメインを使用

ドメインは1つのブランチにのみ割り当てることができます。別のブランチに割り当てると、前の割り当てが上書きされます。

## 関連ドキュメント

- [ドメインの追加](/docs/domains/working-with-domains/add-a-domain)
- [環境へのドメイン追加](/docs/domains/working-with-domains/add-a-domain-to-environment)
- [デプロイとリダイレクト](/docs/domains/working-with-domains/deploying-and-redirecting)

## まとめ

Gitブランチへのドメイン割り当ては、異なる環境を管理するための強力な機能です。ステージング、開発、機能プレビュー環境に固定ドメインを割り当てることで、チーム全体で一貫したテストとレビューが可能になります。
