# Query（Vercel可観測性）

## 概要

QueryはEnterpriseおよびProプランで利用可能な機能で、アプリケーションのパフォーマンスと使用状況に関する深い可視性を提供します。以下が可能です：

- エラーとレイテンシの調査
- トラフィックパターンの分析
- AIモデルとAPIエンドポイントのパフォーマンス監視
- ビルドとデプロイメントの動作追跡
- ノートブックにクエリを保存
- カスタムダッシュボードの作成

## 開始方法

### Observability Plusを有効化

- オーナーロールが必要
- ProおよびEnterpriseチームで利用可能
- モーダルでクエリを編集可能

### 新しいクエリの作成

#### 手順

**1. 可観測性ダッシュボードにアクセス**

- チームレベル: Vercelダッシュボード > Observabilityタブ
- プロジェクトレベル: プロジェクトを選択 > Observabilityタブ

**2. クエリを開始**

- 「New Query」ボタンをクリック
- データソース（メトリック）を選択

**3. クエリパラメータを定義**

- データ集約方法を選択
- 時間範囲を設定
- フィルタを適用

**4. 結果を可視化**

- グラフの自動更新
- 表示オプション：
  - 折れ線/ボリュームチャート
  - テーブル
  - 時系列付き大きな数値

**5. 保存と共有**

- 既存のノートブックに追加
- チームメンバーと共有

## 主な機能

### 複数の可視化タイプ

- 折れ線チャート
- ボリュームチャート
- テーブル表示
- 大きな数値表示

### 詳細なフィルタリング

以下でフィルタリング可能：
- プロジェクト
- パス
- リージョン
- ステータスコード
- 環境
- その他多数

### AI アシスタント

- クエリ作成の支援
- 自然言語での質問
- 推奨されるクエリ

### カスタマイズ可能なダッシュボード

- 複数のクエリを整理
- カスタムビューの作成
- チームとの共有

## IPアドレスの可視性

- ダッシュボード設定で管理可能
- プライバシーの考慮事項に対応してトグル可能
- DDoS緩和などのビジネス目的で引き続き収集

## 利用可能性

- EnterpriseまたはProプランが必要
- 適切なロールを持つユーザーがアクセス可能

## 使用例

### エラー率の追跡

1. メトリックとして「エラー」を選択
2. ステータスコード5xxでフィルタリング
3. 時間経過に伴う傾向を可視化
4. 特定のエンドポイントを特定

### レイテンシの分析

1. メトリックとして「Duration」を選択
2. パーセンタイル（p75、p95）を選択
3. パス別にグループ化
4. 遅いエンドポイントを特定

### トラフィックパターンの監視

1. 「リクエスト」メトリックを使用
2. リージョン別にグループ化
3. 時系列データを分析
4. ピーク時間を特定

## ベストプラクティス

### 効果的なクエリ作成

- 特定の質問から開始
- 適切なメトリックを選択
- 関連するフィルタを適用
- 有意義なグループ化を使用

### パフォーマンスの最適化

- クエリスコープを制限
- 適切な時間範囲を使用
- 不要なフィルタを避ける

### ノートブックの整理

- 関連するクエリをグループ化
- 説明的な名前を使用
- チームと共有

## 次のステップ

- [クエリリファレンス](/docs/query/reference)を探索
- [モニタリング](/docs/query/monitoring)について学ぶ
- [ノートブック](/docs/notebooks)を作成

## 関連リソース

- [可観測性の概要](/docs/observability)
- [Observability Plus](/docs/observability/observability-plus)
- [ランタイムログ](/docs/logs/runtime)
