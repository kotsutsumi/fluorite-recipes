# Turso Database - 暗号化

Turso Databaseのページレベル暗号化機能について説明します。

## 概要

Turso Databaseは、各4 KiBデータベースページに対してページレベルの暗号化を提供します。

## 主な特徴

- **ページレベル暗号化**: 各4 KiBデータベースページを暗号化
- **AEADアルゴリズム対応**: AEGIS-256とAES-GCMをサポート
- **データ整合性**: 認証タグによるデータ整合性を提供
- **最小限のパフォーマンスオーバーヘッド**: 読み取り6%、書き込み14%
- **インメモリキー管理**: 暗号化キーはメモリ内に保存され、ディスクには保存されない

## 理想的な用途

- フィンテックアプリケーション
- プライバシー重視の製品
- ヘルスケアアプリ
- AI/MLアプリケーション

## 暗号化の範囲

### 暗号化される部分

- データベースページ
- データベースファイル
- Write-Ahead Log（WAL）

### 暗号化されない部分

- データベースヘッダー（最初の100バイト）

## キー生成

2つのキーサイズがサポートされています：

### 256ビット（32バイト）

- AEGIS-256用
- AES-256-GCM用

### 128ビット（16バイト）

- AEGIS-128用
- AES-128-GCM用

## 暗号化されたデータベースの作成

`--experimental-encryption`フラグを使用して、暗号化されたデータベースを作成できます。

接続URIに暗号方式と16進数のキーを指定します：

```bash
tursodb --experimental-encryption "file:encrypted.db?cipher=aegis-256&key=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"
```

データの挿入例：

```sql
CREATE TABLE users (id INT, name TEXT);
INSERT INTO users VALUES (1, 'Alice');
SELECT * FROM users;
```

## サポートされている暗号方式

### AES-GCM

- **AES-128-GCM**: 128ビット
- **AES-256-GCM**: 256ビット

### AEGIS

ほとんどのユースケースで推奨される暗号方式です。

以下のバリアントが利用可能：

- AEGIS-128L
- AEGIS-128X2
- AEGIS-128X4
- AEGIS-256
- AEGIS-256X2
- AEGIS-256X4

各バリアントは異なるパフォーマンス特性を持ちます。

## パフォーマンス

- **最小限のオーバーヘッド**: 読み取り約6%、書き込み約14%
- **総合的な時間オーバーヘッド**: 混合ワークロードで1〜3%と推定

## 今後の予定機能

以下の機能が計画されています：

- パスフレーズからのキー導出
- 既存データベースの暗号化
- キーローテーション
- 複数の暗号化データベースのサポート

## 重要な警告

**暗号化キーは安全に保管してください！暗号化キーを紛失した場合、暗号化されたデータベースにアクセスできなくなります。**

## セキュリティのベストプラクティス

1. 暗号化キーを環境変数として保存
2. キーをバージョン管理システムにコミットしない
3. 本番環境では強力なキー管理システムを使用
4. 定期的なバックアップを実施

## 関連リンク

- [Turso公式サイト](https://turso.tech/)
- [Turso GitHub](https://github.com/tursodatabase/turso)
- [Turso Documentation](https://docs.turso.tech/)
