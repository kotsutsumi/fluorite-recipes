# キャッシング

Turborepoはキャッシングを使用してビルドを高速化し、**同じ作業を二度と行わない**ことを保証します。タスクがキャッシュ可能な場合、Turborepoはタスクが最初に実行されたときのフィンガープリントを使用して、キャッシュからタスクの結果を復元します。

> Turborepoはタスクが**決定論的である**ことを前提としています。Turborepoが認識している入力のセットを与えられて、タスクが異なる出力を生成できる場合、キャッシングは期待どおりに機能しない可能性があります。

## 最初のTurborepoキャッシュをヒットする

3つのステップでTurborepoのキャッシング動作を試すことができます：

### 新しいTurborepoプロジェクトを作成する

`npx create-turbo@latest`を使用し、プロンプトに従って新しいTurborepoを作成します。

```bash title="Terminal"
npx create-turbo@latest
```

### 初めてビルドを実行する

[`turbo`をグローバルにインストール](/docs/getting-started/installation#global-installation)している場合、リポジトリで`turbo build`を実行します。

または、パッケージマネージャーを使用して`package.json`の`build`スクリプトを実行することもできます。

```bash title="Terminal"
pnpm run build
```

### キャッシュをヒットする

`turbo build`を再度実行します。次のようなメッセージが表示されます。

## リモートキャッシング

Turborepoはタスクの結果をマシンの`.turbo/cache`ディレクトリに保存します。ただし、このキャッシュをチームメイトやCIと共有することで、組織全体をさらに高速化できます。

### リモートキャッシュの有効化

まず、リモートキャッシュプロバイダーで認証します：

```bash title="Terminal"
npx turbo login
```

次に、マシン上のリポジトリをリモートキャッシュにリンクします：

```bash title="Terminal"
npx turbo link
```

## 何がキャッシュされるか？

Turborepoは2種類の出力をキャッシュします：タスク出力とログです。

### タスク出力

Turborepoは、`turbo.json`の[`outputs`キー](/docs/reference/configuration#outputs)で定義されたタスクのファイル出力をキャッシュします。

> タスクのファイル出力を宣言しない場合、Turborepoはそれらをキャッシュしません。

### ログ

Turborepoは常にタスクのターミナル出力をキャプチャします。

## キャッシュの仕組み

Turborepoは、タスクをキャッシュするかどうかを判断するために2つのハッシュを作成します：

### グローバルハッシュ

グローバルハッシュは、リポジトリ全体の入力を考慮します。

### パッケージ固有のハッシュ

パッケージ固有のハッシュは、特定のパッケージとタスクの入力を考慮します。

## キャッシングのトラブルシューティング

### 便利なフラグ

- `--dry`: タスク実行をプレビューします
- `--summarize`: タスクの入出力の詳細な概要を取得します
- `--force`: キャッシュされたタスクを再実行します
- `--cache`: キャッシング動作を制御します

### キャッシングの潜在的な制限

- 非常に高速なタスク
- 非常に大きな出力アーティファクト
- 複雑な内部キャッシングを持つタスク

## 重要な考慮事項

Turborepoはタスクが**決定論的である**ことを前提としています。同じ入力が与えられた場合にタスクが異なる出力を生成できる場合、キャッシングは期待どおりに機能しない可能性があります。
