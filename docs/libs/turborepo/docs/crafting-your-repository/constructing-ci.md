# CIの構築

Turborepoは、継続的インテグレーションパイプラインで必要なビルド、リント、テスト、その他のタスクを高速化します。並列化と[リモートキャッシング](/docs/core-concepts/remote-caching)により、TurborepoはCIを劇的に高速化します。

CIベンダーをリモートキャッシュに接続してタスクを実行する方法の例については、[CIガイド](/docs/guides/ci-vendors)をご覧ください。

## リモートキャッシングの有効化

CIのリモートキャッシングを有効にするには、Turborepoがリモートキャッシュにアクセスするための環境変数を設定します。

| 環境変数 | 説明 |
| -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `TURBO_TOKEN` | リモートキャッシュにアクセスするためのBearerトークン |
| `TURBO_TEAM` | リポジトリに関連付けられたアカウント名。[Vercelリモートキャッシュ](https://vercel.com/docs/monorepos/remote-caching#vercel-remote-cache)を使用する場合、これは[チームのスラッグ](https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fsettings&title=Get+team+slug)です。 |

`turbo`を通じてタスクを実行すると、CIはキャッシュをヒットできるようになり、パイプラインが高速化されます。

> **リモートキャッシュホスティング**
>
> Vercelの組み込みCI/CDは、ゼロ設定で管理されたVercelリモートキャッシュに自動的に接続されます。他のCIベンダーをVercelリモートキャッシュに接続するためのトークンを取得するには、[Vercelリモートキャッシュドキュメント](https://vercel.com/docs/monorepos/remote-caching#use-remote-caching-from-external-ci/cd)をご覧ください。
>
> セルフホスト型リモートキャッシュオプションについては、[Turborepoのリモートキャッシュドキュメント](/docs/core-concepts/remote-caching#remote-cache-api)をご覧ください。

## CIでのタスクの実行

開発マシンとCIマシンに[`turbo`をグローバルにインストール](/docs/getting-started/installation#global-installation)することで、開発からシップまで、リポジトリ全体を実行するための1つのメンタルモデルを使用できます。`turbo.json`に登録したタスクは、ローカル開発で使用するのと同じように使用できます。

### タスクのフィルタリング

`--filter`フラグを使用して、特定のパッケージ、ディレクトリ、またはGit履歴に基づいてタスクをフィルタリングできます。

## Docker統合

`turbo prune`は、軽量なDockerイメージを作成するのに役立ち、不要な依存関係とコードを削除します。

## タスク最適化戦略

`--affected`フラグを使用して、変更されたパッケージのタスクのみを実行します。これは大規模なモノレポに便利で、GitHub Actionsで変更を自動的に検出します。

## ベストプラクティス

- キャッシングに依存する
- グローバル`turbo`インストールをメジャーバージョンに固定する
- CIで`turbo run`を使用して潜在的なコマンドの競合を防ぐ

## トラブルシューティング

- タスクの正しい`outputs`設定を確認する
- 正確なキャッシングのための環境変数定義を確認する

## 重要な考慮事項

Turborepoを使用したCIの構築により、効率的でスケーラブルな継続的インテグレーションプロセスが実現します。並列化とリモートキャッシングを活用することで、パイプラインの実行時間を大幅に短縮できます。
