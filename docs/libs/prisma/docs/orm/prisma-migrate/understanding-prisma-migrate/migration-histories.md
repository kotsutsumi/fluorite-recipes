# マイグレーション履歴について

## マイグレーション履歴

マイグレーション履歴は、データモデルへの変更を追跡し、2つの主要なコンポーネントで構成されます：

1. マイグレーションサブフォルダを持つ `prisma/migrations` フォルダ：

```
migrations/
└─ 20210313140442_init/
    └─ migration.sql
└─ 20210313140442_added_job_title/
    └─ migration.sql
```

2. 以下を追跡するために使用されるデータベース内の `_prisma_migrations` テーブル：
   - マイグレーションが実行されたかどうか
   - 適用されたマイグレーションが削除されたかどうか
   - 適用されたマイグレーションが変更されたかどうか

## 適用されたマイグレーションを編集または削除しない

**重要なガイドライン：**
- 既に適用されたマイグレーションを編集または削除しないでください
- 既存のマイグレーションを変更すると、開発環境と本番環境の間で不整合が発生する可能性があります
- 変更により、複製が困難な隠れたバグが発生する可能性があります

## マイグレーション履歴をソース管理にコミットする

`prisma/migrations` フォルダ全体をソース管理にコミットする必要があります。これには以下が含まれます：

- すべてのマイグレーションサブフォルダ
- `prisma/migrations/migration_lock.toml` ファイル

マイグレーション履歴全体をコミットする理由：

- Prisma スキーマで表現できないカスタマイズをキャプチャ
- `prisma migrate deploy` はマイグレーションファイルに依存し、Prisma スキーマには依存しない

マイグレーション履歴は、データモデルの進化の「真実の情報源」として機能します。

## ベストプラクティス

1. **マイグレーション履歴をコミット**: すべてのマイグレーションファイルをバージョン管理にコミット
2. **マイグレーションを編集しない**: 適用済みのマイグレーションは変更しない
3. **チームと同期**: チームメンバーとマイグレーション履歴を共有
4. **ドキュメント化**: 重要なマイグレーションの目的を文書化

詳細については、[公式ドキュメント](https://www.prisma.io/docs/orm/prisma-migrate/understanding-prisma-migrate/migration-histories)を参照してください。
