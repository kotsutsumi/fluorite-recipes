# Drizzle ORM: 'with'オプションを使用したシーディング

このガイドでは、Drizzle ORMのシーディング機能で1対多の関係を処理するための`with`オプションの使用方法を説明します。

## 主要概念

- `with`オプションはテーブルが1対多の関係を持つことを意味します
- 例: 1人のユーザーが多くの投稿を持つ場合、次のようにシードできます:
  ```typescript
  users: {
      count: 2,
      with: {
          posts: 3,
      },
  }
  ```

## 例のシナリオ

### シナリオ1: ユーザーと投稿
- 次のいずれかが必要:
  1. `authorId`カラムへの参照を追加
  2. スキーマに1対多の関係を追加

### シナリオ2: 逆の関係
- 1つの投稿に対して複数のユーザーを生成できない
- 推奨されるアプローチは、ユーザーが投稿を生成するようにシードすること

### シナリオ3: 自己参照テーブル
- 同じテーブルの複数のインスタンスをそれ自体の中に生成できない
- 複数の関連エントリを作成しようとするとエラーが発生

## 重要な考慮事項

- `with`オプションは1対多の関係でのみ機能
- スキーマで関係を適切に定義する必要がある
- シーディングスクリプトは、固有のデータベース関係構造を尊重する必要がある

## コード例

```typescript
import { seed } from 'drizzle-seed';

// 正しい使用法: ユーザーが投稿を持つ
await seed(db, schema, {
  users: {
    count: 2,
    with: {
      posts: 3, // 各ユーザーに3つの投稿
    },
  },
});

// 誤った使用法: 投稿がユーザーを持つ
// これは動作しません
await seed(db, schema, {
  posts: {
    count: 3,
    with: {
      users: 2, // エラー: 1対多の関係が逆
    },
  },
});
```

## 主なポイント
- 1対多の関係を理解することが重要
- 親エンティティから子エンティティへシード
- スキーマで関係を正しく定義
- 自己参照関係には注意が必要
