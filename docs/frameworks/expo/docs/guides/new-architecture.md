# React Nativeの新しいアーキテクチャ

React Nativeの新しいアーキテクチャは、React Nativeの内部システムを完全にリファクタリングしたものです。

## 新しいアーキテクチャとは

新しいアーキテクチャは、長年の本番運用で発見された制限を解決するために設計されました。今後のReactとReact Nativeの機能は、新しいアーキテクチャでのみ利用可能になります。

## なぜ移行するのか

### 将来への投資

新しいアーキテクチャへの移行は、アプリ開発の将来への投資です。

### 今後の機能

- 完全なSuspenseサポート
- React Concurrent Features
- より良いパフォーマンス

### ライブラリのサポート

ライブラリは、レガシーアーキテクチャのサポートを段階的に廃止していきます。

### アーキテクチャの削除予定

レガシーアーキテクチャは、2025年後半に削除される可能性があります。

## Expoと新しいアーキテクチャのサポート

### SDK 53以降

すべての`expo-*`パッケージは、SDK 53以降で新しいアーキテクチャをサポートしています。

### Expo Modules API

Expo Modules APIを使用するモジュールは、デフォルトで新しいアーキテクチャをサポートしています。

### 採用率

SDK 52以降のプロジェクトの約75%が、EAS Buildで新しいアーキテクチャを使用しています。

## 新しいアーキテクチャの有効化

### SDK 53以降

SDK 53以降では、新しいアーキテクチャがデフォルトで有効になっています。

### SDK 52

SDK 52では、`app.json`で設定します：

```json
{
  "expo": {
    "newArchEnabled": true
  }
}
```

### 設定後

設定を変更した後は、以下を実行します：

```bash
# iOSポッドを再インストール
npx pod-install

# キャッシュをクリア
npx expo start --clear
```

## 依存関係の互換性

### 互換性の確認

`expo-doctor`を使用して、依存関係の互換性を検証します：

```bash
npx expo-doctor
```

### React Native Directory

React Native Directoryで、ライブラリの互換性を確認できます：

- [React Native Directory](https://reactnative.directory/)
- 新しいアーキテクチャのサポート状況が表示されます

### Interopレイヤー

多くのライブラリには、新しいアーキテクチャ用のInteropレイヤーがあります。

## トラブルシューティング

### 非互換なライブラリ

一部のライブラリは、削除または更新が必要な場合があります。

### 既知の非互換ライブラリ

- `react-native-maps`
- `@stripe/react-native`
- 一部のコミュニティライブラリ

### 問題の報告

非互換性の問題を発見した場合は、ライブラリのメンテナーに報告してください。

## 新しいアーキテクチャのコンポーネント

### Fabric

Fabricは、新しいレンダリングシステムです。

**主な改善点**：
- より効率的なレンダリング
- より良いパフォーマンス
- より良いエラーハンドリング

### Turbo Modules

Turbo Modulesは、新しいネイティブモジュールシステムです。

**主な改善点**：
- 遅延読み込み
- 型安全性
- より良いパフォーマンス

### Codegen

Codegenは、ネイティブコードを自動生成するツールです。

**主な機能**：
- TypeScriptからネイティブコードを生成
- 型安全性を保証
- ボイラープレートコードを削減

## 移行のベストプラクティス

### 1. 最新のExpo SDKにアップグレード

常に最新のExpo SDKを使用してください：

```bash
npx expo install expo@latest
npx expo install --fix
```

### 2. 依存関係の更新

すべての依存関係を最新バージョンに更新します：

```bash
npm update
```

### 3. 徹底的なテスト

新しいアーキテクチャを有効にした後、アプリを徹底的にテストしてください。

### 4. 段階的な移行

すべてのコードを一度に移行するのではなく、段階的に移行してください。

## パフォーマンスの最適化

### レンダリングパフォーマンス

新しいアーキテクチャは、レンダリングパフォーマンスを大幅に向上させます。

### ネイティブモジュールのパフォーマンス

Turbo Modulesは、ネイティブモジュールのパフォーマンスを向上させます。

### メモリ使用量

新しいアーキテクチャは、メモリ使用量を削減します。

## よくある質問

### 新しいアーキテクチャは必須ですか？

はい、今後のReactとReact Nativeの機能は、新しいアーキテクチャでのみ利用可能になります。

### いつ移行すべきですか？

できるだけ早く移行することをお勧めします。レガシーアーキテクチャは、2025年後半に削除される可能性があります。

### すべてのライブラリがサポートしていますか？

ほとんどの主要なライブラリは、新しいアーキテクチャをサポートしています。互換性は、React Native Directoryで確認できます。

### パフォーマンスが向上しますか？

はい、新しいアーキテクチャは、パフォーマンスを大幅に向上させます。

## 推奨事項

### 新規プロジェクト

新規プロジェクトでは、常に新しいアーキテクチャを使用してください。

### 既存のプロジェクト

既存のプロジェクトは、できるだけ早く移行してください。

### テスト

移行後は、徹底的にテストしてください。

### コミュニティへの貢献

非互換性の問題を発見した場合は、報告してください。

## 次のステップ

### 1. Expo SDKのアップグレード

最新のExpo SDKにアップグレードします：

```bash
npx expo install expo@latest
```

### 2. 新しいアーキテクチャの有効化

`app.json`で新しいアーキテクチャを有効にします。

### 3. 依存関係の確認

`npx expo-doctor`で依存関係を確認します。

### 4. テスト

アプリを徹底的にテストします。

## まとめ

React Nativeの新しいアーキテクチャは、パフォーマンスと開発者エクスペリエンスを大幅に向上させます。すべてのExpoプロジェクトは、できるだけ早く新しいアーキテクチャに移行することをお勧めします。
