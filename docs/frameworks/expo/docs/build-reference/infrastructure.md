# ビルドサーバーインフラストラクチャ

EASを使用する際の現在のビルドサーバーインフラストラクチャについて学びます。

## ビルダーのIPアドレス

ビルドサーバーのIPアドレスのリストは、[このファイル](https://expo.dev/eas-build-worker-ips.txt)で入手できます。リストが頻繁に変更されることは予想していません。リストには、リストが最後に更新された時刻とリストを変更しないことを約束する時刻をそれぞれ指定する「Last-Modified」および「Expires」ISO 8601タイムスタンプが含まれています。

Linuxランナーは、Google Cloud Platformでホストされています。macOSランナーは、独自のmacOSクラウドでホストされています。

## ビルド環境の設定

各プラットフォームのイメージには、Node.js、Yarn、CocoaPods、Xcode、Ruby、Fastlaneなどの特定のバージョンが1つあります。[eas.json](/build/eas-json)で一部のバージョンを上書きできます。探している専用の設定オプションがない場合は、[npmフック](/build-reference/npm-hooks)を使用して、`apt-get`または`brew`でシステム依存関係をインストールまたは更新できます。これらのカスタマイズはビルド中に適用され、ビルド時間が増加することに注意してください。

ビルド用のイメージを選択する際、以下に示す完全な名前、またはエイリアスの1つを使用できます：`auto`、`latest`、または`sdk-54`などの特定のSDK用。

- 特定の名前を使用すると、マイナーアップデートのみで一貫した環境が保証されます。
- `auto`エイリアスを使用すると、プロジェクト設定、Expo SDKバージョン、およびReact Nativeバージョンに基づいてビルドイメージが選択されます。ビルドに使用されるイメージは、「Spin up build environment」ビルドログセクションで確認できます。
- `latest`エイリアスは、最新のソフトウェアバージョンを持つイメージに割り当てられます。
- `sdk-54`エイリアスは、SDK 54ビルドに最適なイメージに割り当てられます。
- `sdk-53`エイリアスは、SDK 53ビルドに最適なイメージに割り当てられます。
- `sdk-52`エイリアスは、SDK 52ビルドに最適なイメージに割り当てられます。
- SDKエイリアスは、新しいSDKリリースごとに更新されます。
- `latest`エイリアスとSDKエイリアスは、ソフトウェアの更新と新しいSDKリリースで時間とともに変更されます。

## Androidビルドサーバー設定

### 標準リソースクラス

**イメージ**: Ubuntu 22.04

**仮想CPU**: 4コア

**メモリ**: 16 GB

**ディスク**: 100 GB

**主要なソフトウェア**:
- Node.js 18, 20, 22
- npm 10.x
- Yarn 1.22.x
- pnpm 9.x
- Java 17 (OpenJDK)
- Android SDK 35
- Android NDK 26.x
- Gradle 8.x

### Largeリソースクラス

**イメージ**: Ubuntu 22.04

**仮想CPU**: 8コア

**メモリ**: 32 GB

**ディスク**: 200 GB

大規模なAndroidプロジェクトやメモリを多く消費するビルドに推奨されます。

### リソースクラスの選択

eas.jsonでリソースクラスを指定：

```json
{
  "build": {
    "production": {
      "android": {
        "resourceClass": "large"
      }
    }
  }
}
```

## iOSビルドサーバー設定

### 標準リソースクラス (M1)

**イメージ**: macOS Sonoma 14.7

**CPU**: Apple M1、8コア

**メモリ**: 16 GB

**ディスク**: 120 GB

**主要なソフトウェア**:
- Xcode 15.4, 16.0, 16.1
- Node.js 18, 20, 22
- npm 10.x
- Yarn 1.22.x
- pnpm 9.x
- CocoaPods 1.15.x
- Ruby 3.3.x
- Fastlane 2.x

### Largeリソースクラス (M2 Pro)

**イメージ**: macOS Sonoma 14.7

**CPU**: Apple M2 Pro、12コア

**メモリ**: 32 GB

**ディスク**: 240 GB

複雑なiOSプロジェクトやマルチターゲットビルドに推奨されます。

### リソースクラスの選択

eas.jsonでリソースクラスを指定：

```json
{
  "build": {
    "production": {
      "ios": {
        "resourceClass": "m-large"
      }
    }
  }
}
```

## Xcodeバージョンの選択

特定のXcodeバージョンを指定：

```json
{
  "build": {
    "production": {
      "ios": {
        "image": "latest"
      }
    },
    "sdk-52": {
      "ios": {
        "image": "sdk-52"
      }
    }
  }
}
```

## ビルド時間の目安

### Android

- 小規模プロジェクト: 3-5分
- 中規模プロジェクト: 5-10分
- 大規模プロジェクト: 10-20分

### iOS

- 小規模プロジェクト: 5-8分
- 中規模プロジェクト: 8-15分
- 大規模プロジェクト: 15-30分

## パフォーマンスの最適化

1. **適切なリソースクラスの選択**: プロジェクトサイズに応じて
2. **キャッシュの活用**: 依存関係のキャッシュを有効化
3. **増分ビルド**: 変更されたコードのみをビルド
4. **並列ビルド**: 複数のターゲットを並列処理

## 制限事項

- **最大ビルド時間**: 2時間
- **最大保留ビルド数**: アカウントごとにプラットフォームごとに50
- **同時ビルド数**: プランによって異なる

このドキュメントは、EAS Buildのインフラストラクチャに関する最新情報を提供し、ビルド環境の選択と最適化に役立ちます。
