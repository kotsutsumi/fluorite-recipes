# キャッシングとの旅

**公開日**: 2024年10月24日(木曜日)

**著者**: Sebastian Markbåge

## 概要

Next.jsは、App Routerでキャッシングに対する新しい実験的なアプローチを導入しています。新しいシステムは、`<Suspense>`と`use cache`の2つのコアコンセプトに焦点を当てています。

目標は、キャッシングを簡素化し、データフェッチをより明示的に制御できるようにすることです。

## 主なキャッシングアプローチ

### 1. 動的アプローチ

動的なデータフェッチのためにコンポーネントを`<Suspense>`でラップします:

- ストリーミングとリアルタイムデータ更新を可能にする
- デフォルトでキャッシングなし
- 急速に変化するダッシュボードやプロトタイプに適している

```typescript
async function Component() {
  return <Suspense fallback="..."><Component /></Suspense>
}
```

### 2. 静的アプローチ

`"use cache"`ディレクティブを使用してページセグメント全体をキャッシュします:

- ページの静的レンダリングを可能にする
- セグメント内のすべてのデータをキャッシュ可能

```typescript
"use cache"
export default async function Page() {
  return fetch(...) // キャッシュ可能になった
}
```

### 3. 部分的キャッシング

異なるレイアウトとページ間でキャッシング戦略を組み合わせます:

- 各セグメントを個別にキャッシュ可能

## 追加機能

- 明示的なキャッシュ管理のための新しい`cacheTag()`
- キャッシュ期間を定義する`cacheLife()`
- 「seconds」、「minutes」、「hours」などのさまざまなキャッシュライフタイムをサポート

## ステータス

実験的で、本番環境には対応していません。新しいプロジェクトでのみ実験することを推奨します。

このアプローチは、Next.jsでより透明で制御可能なキャッシングメカニズムを提供することを目指しています。
