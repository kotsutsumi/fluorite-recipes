# Next.jsのインストール

プロジェクトでNext.jsを使用する場合、[unpkg.com](http://unpkg.com/)から`react`と`react-dom`スクリプトを読み込む必要はありません。代わりに、`npm`または好みのパッケージマネージャーを使用して、これらのパッケージをローカルにインストールできます。

> **注意**: Next.jsを使用するには、マシンにNode.js バージョン18.17.0以上がインストールされている必要があります（[最小バージョン要件を確認](https://nextjs.org/docs/getting-started/installation)）。[こちらからダウンロード](https://nodejs.org/en/)できます。

そのために、`index.html`ファイルと同じディレクトリに、空のオブジェクト`{}`を含む`package.json`という新しいファイルを作成します。

```json
{}
```

[ターミナル](https://code.visualstudio.com/docs/terminal/basics)で、プロジェクトのルートで次のコマンドを実行します：

```bash
npm install react@latest react-dom@latest next@latest
```

インストールが完了すると、`package.json`ファイル内にプロジェクトの依存関係が表示されるはずです：

```json
{
  "dependencies": {
    "next": "^14.0.3",
    "react": "^18.3.1",
    "react-dom": "^18.3.1"
  }
}
```

上記に示したバージョンより新しいバージョンであっても心配ありません。`next`、`react`、`react-dom`パッケージがインストールされていれば問題ありません。

また、各パッケージの正確なバージョンに関する詳細情報を含む`package-lock.json`という新しいファイルも表示されます。

`index.html`ファイルに戻って、以下のコードを削除できます：

1. `<html>`と`<body>`タグ
2. `id`が`app`の`<div>`要素
3. NPMでインストールしたため、`react`と`react-dom`スクリプト
4. Next.jsにはJSXをブラウザが理解できる有効なJavaScriptに変換するコンパイラがあるため、`Babel`スクリプト
5. `<script type="text/jsx">`タグ
6. `document.getElementById()`と`ReactDom.createRoot()`メソッド
7. `React.useState(0)`関数の`React.`部分

上記の行を削除した後、ファイルの先頭に以下のインポートを追加します：

```javascript
import { useState } from "react";
```

コードは以下のようになるはずです：

```javascript
import { useState } from "react";

function Header({ title }) {
  return <h1>{title ? title : "Default title"}</h1>;
}

function HomePage() {
  const names = ["Ada Lovelace", "Grace Hopper", "Margaret Hamilton"];
  const [likes, setLikes] = useState(0);

  function handleClick() {
    setLikes(likes + 1);
  }

  return (
    <div>
      <Header title="Develop. Preview. Ship." />
      <ul>
        {names.map((name) => (
          <li key={name}>{name}</li>
        ))}
      </ul>
      <button onClick={handleClick}>Like ({likes})</button>
    </div>
  );
}
```

HTMLファイル内に残っているコードはJSXのみなので、ファイルタイプを`.html`から`.js`または`.jsx`に変更できます。

## 最初のページの作成

Next.jsはファイルシステムルーティングを使用します。これは、アプリケーションのルートを定義するためにコードを使用する代わりに、フォルダとファイルを使用できることを意味します。

Next.jsで最初のページを作成する方法は以下の通りです：

1. [app](https://nextjs.org/docs/app/building-your-application/routing#the-app-router)という新しいフォルダを作成し、`index.js`ファイルをその中に移動します。
2. `index.js`ファイルの名前を`page.js`に変更します。これがアプリケーションのメインページになります。
3. `<HomePage>`コンポーネントに`export default`を追加して、Next.jsがページのメインコンポーネントとしてレンダリングするコンポーネントを区別できるようにします。

```javascript
// app/page.js
import { useState } from "react";

function Header({ title }) {
  return <h1>{title ? title : "Default title"}</h1>;
}

export default function HomePage() {
  // ...
}
```

## 開発サーバーの実行

次に、開発中に新しいページの変更を確認できるように、開発サーバーを実行しましょう。`package.json`ファイルに`"next dev"`スクリプトを追加します：

```json
{
  "scripts": {
    "dev": "next dev"
  },
  "dependencies": {
    "next": "^14.0.3",
    "react": "^18.3.1",
    "react-dom": "^18.3.1"
  }
}
```

ターミナルで`npm run dev`を実行して何が起こるかを確認してください。2つのことに気づくでしょう：

1. [localhost:3000](http://localhost:3000/)にアクセスすると、以下のエラーが表示されるはずです：

「useStateを必要とするコンポーネントをインポートしています。これはクライアントコンポーネントでのみ動作します...」

これは、Next.jsがReactの新機能であるReact Server Componentsを使用するためです。Server Componentsは`useState`をサポートしていないため、代わりにClient Componentを使用する必要があります。

次の章では、ServerコンポーネントとClientコンポーネントの主な違いについて説明し、このエラーを修正します。

2. `app`フォルダ内に`layout.js`という新しいファイルが自動的に作成されました。これはアプリケーションのメインレイアウトです。すべてのページで共有されるUI要素（例：ナビゲーション、フッターなど）を追加するために使用できます。

```javascript
// /app/layout.js
export const metadata = {
  title: "Next.js",
  description: "Generated by Next.js",
};

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  );
}
```

## まとめ

これまでの移行を見ると、Next.jsを使用することの利点を既に感じているかもしれません：

• ReactとBabelスクリプトを削除しました。もう考える必要のない複雑なツールと設定の味見です。
• 最初のページを作成しました。

> **追加読み物:**
> • [Next.jsルーティング基礎](https://nextjs.org/docs/app/building-your-application/routing)
> • [ルートの定義](https://nextjs.org/docs/app/building-your-application/routing/defining-routes)
> • [ページとレイアウト](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts)

## 第9章完了

Next.jsをインストールし、最初のアプリの構築を開始する準備が整いました。

**次回：第10章 - サーバーコンポーネントとクライアントコンポーネント**

サーバーコンポーネントとクライアントコンポーネントをいつ使用するかを学びます。
