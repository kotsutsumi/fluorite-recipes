# キャッシング

Next.jsにおけるキャッシングメカニズムについて説明します。

## 概要

Next.jsは、アプリケーションのパフォーマンスを向上させ、コストを削減するための4つの主要なキャッシングメカニズムを提供しています。

## 1. リクエストメモ化 (Request Memoization)

- 同じURLとオプションを持つ `fetch` リクエストを自動的にメモ化
- 単一のレンダリングパス中の重複リクエストを防止
- `GET` メソッドリクエストのみに適用
- サーバーリクエストの期間中のみ持続

## 2. データキャッシュ (Data Cache)

- サーバーリクエストとデプロイメント全体でデータを永続化
- `fetch` オプションを通じて設定可能
- 2つの再検証戦略：

### a. 時間ベースの再検証

指定された時間間隔後にデータを再検証します。

- `next.revalidate` オプションを使用

### b. オンデマンド再検証

`revalidatePath` または `revalidateTag` を使用して手動で再検証します。

## 3. フルルートキャッシュ (Full Route Cache)

- レンダリングされたHTMLとReact Server Componentペイロードをキャッシュ
- 静的にレンダリングされたルートに適用
- 以下を通じて無効化可能：
  - データ再検証
  - 再デプロイ

## 4. クライアントサイドルーターキャッシュ (Client-side Router Cache)

- React Server Componentペイロードを保存するインメモリキャッシュ
- ナビゲーションパフォーマンスを向上
- 特定の期間キャッシュ（デフォルト: 5分）
- Server Actionsまたは `router.refresh()` を通じて無効化可能

## 主要なキャッシングAPIとオプション

### `fetch` オプション

- `cache`: キャッシング動作を制御
- `next.revalidate`: 再検証時間を設定
- `next.tags`: キャッシュタグを追加

### ルートセグメント設定

- `dynamic`: ルートレンダリングを制御
- `fetchCache`: fetch キャッシング動作を変更

## ベストプラクティス

- Next.jsはデフォルトで積極的にキャッシュを行う
- ほとんどのキャッシングは適切なデフォルト値で自動的に行われる
- 特定のユースケースに応じて必要に応じてキャッシングをカスタマイズする

## まとめ

これらのメカニズムを理解することは有用ですが、Next.jsで生産的に作業するために必須ではありません。Next.jsは、パフォーマンスを最適化するための賢明なデフォルト設定を提供しています。
